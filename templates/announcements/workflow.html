{% extends 'base.html' %}

{% block title %}System Workflow - RailAnnounce{% endblock %}

{% block extra_css %}
<style>
    .workflow-hero {
        min-height: 60vh;
        padding: 8rem 1.5rem 4rem;
        position: relative;
        display: flex;
        align-items: center;
        justify-content: center;
        text-align: center;
    }
    .workflow-hero .headline {
        max-width: 900px;
        backdrop-filter: blur(20px);
        background: rgba(15, 23, 42, 0.72);
        border: 1px solid rgba(148, 163, 184, 0.25);
        border-radius: 24px;
        padding: 3rem;
        box-shadow: 0 30px 60px rgba(15, 23, 42, 0.45);
    }
    .workflow-hero h1 {
        font-size: clamp(2.8rem, 6vw, 4rem);
        font-weight: 700;
        margin-bottom: 1rem;
    }
    .workflow-hero p {
        font-size: 1.15rem;
        color: rgba(226, 232, 240, 0.8);
    }

    .workflow-track {
        max-width: 1100px;
        margin: 0 auto;
        padding: 0 1.5rem 6rem;
        position: relative;
    }
    .workflow-track::before {
        content: '';
        position: absolute;
        left: calc(50% - 2px);
        top: 0;
        bottom: 0;
        width: 4px;
        background: linear-gradient(180deg, rgba(96, 165, 250, 0.15) 0%, rgba(59, 130, 246, 0.45) 50%, rgba(14, 165, 233, 0.2) 100%);
        transform-origin: top;
    }

    .workflow-step {
        position: relative;
        margin-bottom: 6rem;
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 3rem;
    }
    .workflow-step:nth-child(even) {
        flex-direction: row-reverse;
    }
    .step-badge {
        width: 72px;
        height: 72px;
        border-radius: 50%;
        background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
        box-shadow: 0 12px 30px rgba(37, 99, 235, 0.45);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
        font-weight: 700;
        color: #fff;
        position: relative;
        z-index: 2;
    }
    .step-card {
        flex: 1;
        padding: 2.5rem;
        background: rgba(15, 23, 42, 0.78);
        border-radius: 20px;
        border: 1px solid rgba(148, 163, 184, 0.18);
        box-shadow: 0 24px 48px rgba(15, 23, 42, 0.4);
        transform: translateY(40px);
        opacity: 0;
    }
    .step-card h3 {
        font-size: 1.6rem;
        font-weight: 600;
        margin-bottom: 1rem;
    }
    .step-card p {
        color: rgba(226, 232, 240, 0.78);
        line-height: 1.75;
        margin-bottom: 1.5rem;
    }
    .tech-grid {
        display: flex;
        flex-wrap: wrap;
        gap: 0.75rem;
    }
    .tech-chip {
        padding: 0.45rem 0.9rem;
        border-radius: 999px;
        background: rgba(96, 165, 250, 0.15);
        border: 1px solid rgba(96, 165, 250, 0.35);
        color: rgba(226, 232, 240, 0.95);
        font-size: 0.85rem;
        letter-spacing: 0.02em;
        text-transform: uppercase;
    }

    .legend-section {
        max-width: 1100px;
        margin: 4rem auto 6rem;
        padding: 3rem;
        background: rgba(15, 23, 42, 0.8);
        border-radius: 24px;
        border: 1px solid rgba(148, 163, 184, 0.2);
        box-shadow: 0 30px 60px rgba(15, 23, 42, 0.45);
    }
    .legend-grid {
        display: grid;
        gap: 2rem;
        grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
    }
    .legend-card {
        padding: 1.5rem;
        border-radius: 16px;
        background: rgba(30, 41, 59, 0.6);
        border: 1px solid rgba(148, 163, 184, 0.12);
    }
    .legend-card h4 {
        font-size: 1.15rem;
        margin-bottom: 0.75rem;
    }
    .legend-card p, .legend-card ul {
        color: rgba(226, 232, 240, 0.7);
        font-size: 0.95rem;
        line-height: 1.6;
    }

    @media (max-width: 992px) {
        .workflow-track::before {
            left: 12px;
        }
        .workflow-step,
        .workflow-step:nth-child(even) {
            flex-direction: column;
            align-items: flex-start;
            padding-left: 2.5rem;
        }
        .step-badge {
            margin-bottom: 1.5rem;
        }
        .step-card {
            width: 100%;
        }
    }
</style>
{% endblock %}

{% block hero_fullwidth %}
<section class="workflow-hero">
    <div class="headline" data-animate="hero">
        <h1>How RailAnnounce Comes Alive</h1>
        <p>From operators on the ground to passengers in motion—this workflow orchestrates translations, audio, real-time boards, and automation so stations stay in harmony.</p>
    </div>
</section>
{% endblock %}

{% block content %}
<section class="workflow-track">
    <div class="workflow-step" data-animate="step">
        <div class="step-badge">01</div>
        <div class="step-card">
            <h3>Capture &amp; Contextualize</h3>
            <p>Operators authenticate and craft announcements enriched with metadata—priority, location, handler details, and timing—ensuring downstream systems understand how to treat each message.</p>
            <div class="tech-grid">
                <span class="tech-chip">Django Forms</span>
                <span class="tech-chip">Session Auth</span>
                <span class="tech-chip">Celery Trigger</span>
            </div>
        </div>
    </div>

    <div class="workflow-step" data-animate="step">
        <div class="step-badge">02</div>
        <div class="step-card">
            <h3>Language Intelligence</h3>
            <p>Announcements route through AI-driven language detection. Gemini-powered translation expands messages across five Indic languages, while LibreTranslate stands ready for offline continuity.</p>
            <div class="tech-grid">
                <span class="tech-chip">Gemini API</span>
                <span class="tech-chip">LibreTranslate (Fallback)</span>
                <span class="tech-chip">LanguageDetector</span>
            </div>
        </div>
    </div>

    <div class="workflow-step" data-animate="step">
        <div class="step-badge">03</div>
        <div class="step-card">
            <h3>Voice &amp; Atmosphere</h3>
            <p>Text transforms into audio using the adaptive TTS pipeline. Coqui studio voices and fallback synthesizers ensure platform-wide announcements are always audible and on brand.</p>
            <div class="tech-grid">
                <span class="tech-chip">TTS Service</span>
                <span class="tech-chip">Coqui</span>
                <span class="tech-chip">Waveform Analysis</span>
            </div>
        </div>
    </div>

    <div class="workflow-step" data-animate="step">
        <div class="step-badge">04</div>
        <div class="step-card">
            <h3>Instant Delivery</h3>
            <p>WebSockets fan out updates to station dashboards in real time. GSAP-enhanced boards scroll live feeds while admin controls keep operations in sync during rapid changes.</p>
            <div class="tech-grid">
                <span class="tech-chip">Django Channels</span>
                <span class="tech-chip">WebSockets</span>
                <span class="tech-chip">GSAP</span>
            </div>
        </div>
    </div>

    <div class="workflow-step" data-animate="step">
        <div class="step-badge">05</div>
        <div class="step-card">
            <h3>Notification Spine</h3>
            <p>Critical stakeholders receive contextual emails, dispatched asynchronously by Celery workers via Gmail SMTP—ensuring communication travels as fast as trains themselves.</p>
            <div class="tech-grid">
                <span class="tech-chip">Celery Workers</span>
                <span class="tech-chip">Gmail SMTP</span>
                <span class="tech-chip">Async Delivery</span>
            </div>
        </div>
    </div>

    <div class="workflow-step" data-animate="step">
        <div class="step-badge">06</div>
        <div class="step-card">
            <h3>Operational Feedback</h3>
            <p>Resolved announcements shift states, turning green on boards and self-expiring after 60 seconds—keeping the signal path clean and primed for the next operation.</p>
            <div class="tech-grid">
                <span class="tech-chip">Admin Controls</span>
                <span class="tech-chip">Auto Cleanup</span>
                <span class="tech-chip">Celery Countdown</span>
            </div>
        </div>
    </div>
</section>

<section class="legend-section" data-animate="legend">
    <h2 class="mb-4">Technology Stack Snapshot</h2>
    <div class="legend-grid">
        <div class="legend-card">
            <h4>Application Core</h4>
            <p>Django orchestrates models, session-driven auth, and structured views. Celery offloads expensive tasks ensuring the UI stays responsive.</p>
            <ul>
                <li>Django 5</li>
                <li>Celery + Redis</li>
                <li>Django Channels</li>
            </ul>
        </div>
        <div class="legend-card">
            <h4>Intelligence Layer</h4>
            <p>Gemini and LibreTranslate power multi-lingual support, while TTS services (Coqui / offline engines) deliver synthesized speech.</p>
            <ul>
                <li>Gemini AI</li>
                <li>LibreTranslate</li>
                <li>Coqui TTS</li>
            </ul>
        </div>
        <div class="legend-card">
            <h4>Experience Fabric</h4>
            <p>GSAP animates motion across hero, workflow and boards. Bootstrap keeps layout responsive while the global GIF background unifies brand feel.</p>
            <ul>
                <li>GSAP 3</li>
                <li>Bootstrap 5</li>
                <li>Space Grotesk</li>
            </ul>
        </div>
        <div class="legend-card">
            <h4>Reliability & Ops</h4>
            <p>Email alerts route via Gmail SMTP; fallback scripts and setup guides ensure the station can reboot safely anytime.</p>
            <ul>
                <li>Gmail SMTP</li>
                <li>Setup Scripts</li>
                <li>Documentation Toolkit</li>
            </ul>
        </div>
    </div>
</section>
{% endblock %}

{% block extra_js %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>
<script>
    gsap.registerPlugin(ScrollTrigger);

    gsap.from('[data-animate="hero"]', {
        y: 40,
        opacity: 0,
        duration: 1.2,
        ease: 'power3.out'
    });

    gsap.utils.toArray('[data-animate="step"]').forEach((step, index) => {
        const card = step.querySelector('.step-card');
        gsap.timeline({
            scrollTrigger: {
                trigger: step,
                start: 'top 70%',
                toggleActions: 'play none none reverse'
            }
        })
        .from(step.querySelector('.step-badge'), {
            scale: 0,
            opacity: 0,
            duration: 0.4,
            ease: 'back.out(1.7)'
        })
        .to(card, {
            y: 0,
            opacity: 1,
            duration: 0.8,
            ease: 'power3.out'
        }, '-=0.2');
    });

    gsap.from('[data-animate="legend"]', {
        scrollTrigger: {
            trigger: '[data-animate="legend"]',
            start: 'top 75%',
        },
        y: 60,
        opacity: 0,
        duration: 1.1,
        ease: 'power3.out'
    });
</script>
{% endblock %}

